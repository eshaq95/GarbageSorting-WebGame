<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <title>Making your first Phaser 3 Game - Part 10</title>
    <script src="./JS/phaser.js"></script>
    <style type="text/css">
        body {
            margin: 0;
        }
    </style>
    <link rel="stylesheet" type="text/css" href="./css/style.css" />
</head>

<body>
    <script type="text/javascript">
        var config = {
            type: Phaser.AUTO,
            width: 800,
            height: 600,
            parent: "phaser-example",
            physics: {
                default: "arcade",
                arcade: {
                    gravity: {
                        y: 200,
                    },
                },
            },
            scene: {
                preload: preload,
                create: create,
            },
        };

        var selectBin;
        var game = new Phaser.Game(config);

        function preload() {
            this.load.image("bg", "img/background.png");
            this.load.image("yellowbin", "img/yellow.png");
            this.load.image("ball", "img/22.png");
        }

        function create() {
            this.add.image(400, 300, "bg");
            bin = this.physics.add.group({
                immovable: true,
                allowGravity: false,
            });
            syellowbin = bin.create(430 + 125, 420, "yellowbin");
            syellowbin.setDisplaySize(120, 150);
            var group = this.physics.add.group({
                // key: "ball",
                bounceX: 0.1,
                bounceY: 0.1,
                collideWorldBounds: true,
                // velocityX: 180,
                // velocityY: 120,
            });
            let temp = group.create(100, 100, "ball");
            this.input.setDraggable(temp.setInteractive());
            this.input.on("drag", function(pointer, gameObject, dragX, dragY) {
                gameObject.x = dragX;
                gameObject.y = dragY;
                gameObject.setData("isDrag", "true");
                gameObject.setDepth(1);
                gameObject.setBounceY(0);
                gameObject.body.setAllowGravity(false);
            });
            //set z index back
            this.input.on("dragend", function(pointer, gameObject) {
                gameObject.setDepth(0);
                gameObject.setData("isDrag", "false");
                console.log("dragend selectBin:", selectBin);
                if (selectBin == "greenbin") gameObject.disableBody(true, true);
                else {
                    gameObject.body.setAllowGravity(true);
                    gameObject.setBounceY(Phaser.Math.FloatBetween(0.2, 0.3));
                }
                selectBin = "";
            });
            temp.setCollideWorldBounds(true);

            //Phaser.Actions.RandomRectangle(group.getChildren(), this.cameras.main);

            Phaser.Actions.Call(group.getChildren(), function(ball) {
                ball.body.onWorldBounds = true;
            });

            this.physics.world.on("worldbounds", onWorldBounds);
        }

        function onWorldBounds(body) {
            var ball = body.gameObject;
            var frame = ball.frame.name;

            frame += 1;
            frame %= 5;

            ball.setFrame(frame);
            console.log("te");
        }
    </script>
</body>

</html>